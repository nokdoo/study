# 4.4 Thread Libraries
---
Thread library는 프로그래머에게 스레드 생성과 관리에 대한 API를 제공한다. 스레드 라이브러리를 구현하는 방법에는 두 가지 핵심 방법이 있다. 첫 번째는 커널의 지원 없이 사용자 영역에 전체 라이브러리를 제공하는 것이다. 라이브러리에 대한 모든 코드와 자료 구조는 사용자 영역에 존재한다. 이것은 라이브러리 함수를 호출하는 것은 system call이 아닌 사용자 영역에서 로컬 함수를 실행하는 결과를 가져온다.

두 번째 방법은 os에 의해 직접 지원받는 kernel-level 라이브러리를 구현하는 것이다. 이 경우 라이브러리에 대한 코드와 자료 구조는 커널 영역에 존재한다. 일반적으로 라이브러리에 대한 API 함수 호출은 커널에 대한 system call로 이어진다.

오늘날에 POSIX Pthreads, Windows, Java 세 가지 메인 스레드 라이브러리가 사용된다. POSIX 표준의 확장 스레드인 Pthreads는 user-level 또는 kernel-level 라이브러리로 제공될 수 있다. Windows 스레드 라이브러리는 Windows system에서 이용되는 kernel-level 라이브러리이다. Java thread API는 스레드가 Java 프로그램에 의해 직접 생성되고 관리되는 것을 허용한다. 하지만 대부분의 경우 JVM은 host os의 top에서 실행되고 있기 때문에, Java thread API는 일반적으로 host system에서 이용되는 스레드 라이브러리를 사용해서 구현된다. 이것은 Windows systems에서 Java threads는 일반적으로 Windows API를 사용해서 구현되는 것을 말한다. UNIX, Linux system은 종종 Pthreads를 사용한다.

POSIX와 Windows의 스레딩을 위해서 함수 밖에서 전역적으로 선언된 데이터는 같은 프로세스에 속해 있는 모든 스레드에 공유된다. 자바는 전역 데이터 개념을 가지고 있지 않기 때문에 공유된 데이터로의 접근은 스레드 간에 명시적으로 정렬되어야 한다. 한 함수에 지역적으로 선언된 데이터는 일반적으로 스택에 저장된다. 각 스레드는 스택을 가지고 있기 때문에 로컬 데이터의 복사본을 가지고 있는다.

이번 절의 남은 부분에서는 이 세 가지 라이브러리를 사용하는 기본적인 스레드 생성을 설명할 것이다. 예로써 별개의 스레드에서 양의 정수의 합을 계산하는 멀티스레딩 프로그램을 설계할 것이다.

summation의 설명, 생략함.

스레드 생성을 진행하기 전에, multiple thread를 생성하는 asynchronous threading과 synchronous threading 두 전략에 대해서 알아보자. asynchronous threading은 부모 스레드가 자식 스레드를 생성하면 부모는 계속 실행되고 자식과 동시에 실행된다. 각 스레드는 다른 스레드와는 독립적으로 실행하고 부모 스레드는 자식 스레드가 종료되는 시점을 알 필요가 없다. 스레드는 독립적이기 때문에 일반적으로 스레드 간 작은 데이터 공유가 일어난다. asynchronous threading은 [Figure 4.2, p165]에서 설명한 멀티스레딩 서버에서 사용되는 전략이다.

synchronous threading은 부모 스레드가 하나 이상의 자식 스레드를 생성할 때 발생하고, 실행을 재개하기 전에 모든 자식 스레드가 종료되기를 기다려야 한다. 이 전략을 `fork-join`이라고도 부른다. 부모 스레드에 의해 생성된 스레드는 동시에 작업을 수행한다. 하지만 부모 스레드는 이 작업들이 종료될 때까지 실행할 수 없다. 각 스레드가 작업을 끝내면 종료됨과 동시에 부모 스레드에 합류한다. 모든 자식 스레드가 종료되어야만 부모 스레드는 실행을 재개할 수 있다. 예를 들어 부모 스레드는 자식에 의해 계산된 결과를 결합한다. 이어지는 모든 예제는 synchronous threading을 사용한다.
