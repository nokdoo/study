# 3.3.2 Process Termination
---
프로세스는 final statement가 종료되고 exit() system call을 사용하여 os에 제거를 요청할 때 종료된다. 이 시점에서, 해당 프로세스는 (보통 int 값을 가지는) status value를 wait() system call을 통해 부모 프로세스에 반환한다. 물리적인 혹은 가상의 메모리, 열린 파일, i/o 버퍼를 포함하는 프로세스의 모든 자원은 os에 반환된다.

프로세스의 종료는 다른 상황에서도 일어날 수 있다. 다른 프로세스의 적당한 system call 호출을 통해 프로세스의 종료가 발생할 수 있다. 일반적으로 그러한 system call은 종료되는 프로세스의 부모 프로세스에 의해서만 호출될 수 있다. 다른 경우로는, 사용자가 서로 다른 job을 임의로 종료할 수 있다. 자식 프로세스를 종료할 경우, 부모 프로세스는 자식 프로세스를 식별할 수 있어야 한다. 그러므로 프로세스가 새로운 프로세스를 생성할 때 새롭게 생성된 프로세스의 식별자는 부모 프로세스에 전달 된다.

부모 프로세스는 다음처럼 다양한 이유로 자식 프로세스의 실행을 종료할 수 있다.

* 자식 프로세스가 할당된 자원의 사용량을 초과한 경우. (초과 여부를 결정하기 위해서 부모 프로세스는 자식 프로세스를 감시하는 메커니즘을 가지고 있어야 한다.)
* 자식 프로세스에 할당된 task가 더 이상 필요하지 않은 경우.
* 부모가 종료되고, os가 자식 프로세스의 작업을 허용하지 않는 경우.

부모 프로세스가 종료되면 자식 프로세스의 존재를 허용하지 않는 시스템도 있다. 이러한 시스템에서는, 프로세스가 종료되면 그 자식 프로세스는 모두 종료되어야 한다. cascading termination이라 불리는 이 현상은 일반적으로 os에 의해 초기화 된다.

프로세스의 실행과 종료를 설명하기 위해서, 유닉스나 리눅스에서 exit() system call을 사용해서 프로세스를 종료할 수 있고, 파라미터로 exit status를 전달할 수 있음을 생각하라.

    # exit with status 1
    exit(1);

사실 일반적인 종료는 위처럼 직접적으로 exit()로 호출되거나, 간접적으로 main()의 return statement로 호출될 수 있다. 부모 프로세스는 wait() system call을 이용해서 자식 프로세스의 종료를 기다릴 것이다. wait() system call은 부모 프로세스가 자식 프로세스의 exit status를 얻도록 하는 파라미터를 전달받는다. 이 system call은 종료되는 자식 프로세스의 pid를 반환하기에 부모 프로세스는 자식 프로세스의 종료를 알 수 있다.

    pid_t pid;
    int status;

    pid = wait(&status);

프로세스가 종료될 때, 그 자원은 os에 의해서 반환된다. 그러나 프로세스의 exit status는 프로세스 테이블이 가지고 있기 때문에, 자식 프로세스의 entry는 부모 프로세스가 wait()를 호출할 때까지 프로세스 테이블에 남아 있어야 한다. 어떤 프로세스는 종료 되었지만 부모 프로세스가 아직 wait()를 호출하지 않은 채로 남아 있다. 이런 자식 프로세스를 zombie 프로세스라 한다. 모든 프로세스는 종료될 때 좀비 프로세스로 변환하지만, 일반적으로 매우 잠깐 동안만 존재한다. 부모 프로세스가 wait()을 호출하면, 좀비 프로세스의 pid와 프로세스 테이블의 entry는 해제된다.

이제 부모 프로세스가 wait()를 호출하지 않고 종료되는 상황을 생각하자. 그렇게 되면 자식 프로세스는 orphans(고아)로써 남겨지게 된다. 리눅스와 유닉스는 init 프로세스를 새로운 부모 프로세스로써 고아 프로세스에 할당함으로서 이런 상황을 처리한다(Figure 3.8, p116). init 프로세스는 주기적으로 wait()를 호출하여 고아 프로세스의 exit status를 수집하고 pid와 프로세스 테이블 entry를 해제한다.

---

프로세스는 exit()를 통해 종료되고, 부모 프로세스의 wait()를 통해 status value를 반환한다. 반환되는 프로세는 가지고 있던 모든 자원이 해제된다. exit()는 exit status를 전달한다.
<br>
exit status는 자식 프로세스의 pid를 받는 wait()의 파라미터가 될 수 있다.
<br>
프로세스는 종료될 때 exit status는 부모의 wait()이 알 수 있도록 남겨져 있어야 한다. 이 때문에 exit status는 프로세스 테이블에 저장되어 있으며 이 상태를 좀비 프로세스라 한다. 좀비 프로세스는 부모 프로세스가 wait()로 exit status를 사용하면 사라진다.
<br>
부모 프로세스가 wait()를 호출하지 않고 종료되면 자식 프로세스는 여전히 종료되지 않고 남아 있을 것이다. init 프로세스는 이를 지속적으로 감시하여 자신을 고아 프로세스의 부모 프로세스로써 연결시켜 문제를 해결한다.
